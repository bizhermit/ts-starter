#! /usr/bin/env node
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var a=Object.getOwnPropertyDescriptor(t,i);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,a)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const path_1=__importDefault(require("path")),fse=__importStar(require("fs-extra")),cp=__importStar(require("child_process")),cli_utils_1=require("@bizhermit/cli-utils"),string_utils_1=require("@bizhermit/basic-utils/dist/string-utils"),create_cli_1=__importDefault(require("../dist/create-cli")),create_module_1=__importDefault(require("../dist/create-module")),create_next_app_1=__importDefault(require("../dist/create-next-app")),create_react_native_1=__importDefault(require("../dist/create-react-native")),create_react_app_1=__importDefault(require("../dist/create-react-app")),sepStr="::::::::::::::::::::::::::::::",pkg=require("../package.json");(0,cli_utils_1.wl)(sepStr),(0,cli_utils_1.wl)(`\n${pkg.name} v${pkg.version}`);const dir=path_1.default.join(process.cwd(),(0,cli_utils_1.getArg)()||"./");(0,cli_utils_1.wl)(`  dirname: ${dir}`);const argProjectType=(0,cli_utils_1.getKeyArg)("-t","--type"),skipInteractive=null!=argProjectType&&argProjectType.length>0,appName=(0,cli_utils_1.getKeyArg)("--appName");appName&&(0,cli_utils_1.wl)(`  appName: ${appName}`);const descriptions={c:"cancel",mod:"module",cli:"command line interface application",fas:"frontend application server [ [36mNext.js[39m ]",bas:"backend application server  [ [36mExpress[39m + [36mNext.js[39m ]",web:"web application server      [ [36mExpress[39m + [36mNext.js[39m ]",dsk:"desktop application         [ [36mElectron[39m + [36mNext.js[39m ]",app:"web & desktop application   [ [36mExpress[39m + [36mElectron[39m + [36mNext.js[39m ]",stt:"react app",mob:"mobile application          [ [36mreact-native[39m ]"},descriptionLine=e=>`- ${(0,string_utils_1.fillRight)(`[[33m${e}[39m]`,15," ")}: ${descriptions[e]}`;skipInteractive||(0,cli_utils_1.wl)(`\n[32mselect project type[39m\n${descriptionLine("c")}\n${descriptionLine("mod")}\n${descriptionLine("cli")}\n${descriptionLine("fas")}\n${descriptionLine("bas")}\n${descriptionLine("web")}\n${descriptionLine("dsk")}\n${descriptionLine("app")}\n${descriptionLine("mob")}`);const changeDir=()=>{fse.existsSync(dir)||((0,cli_utils_1.wl)(`create dir : ${dir}`),fse.mkdirSync(dir,{recursive:!0})),cp.spawnSync("cd",[dir],{shell:!0,stdio:"inherit",cwd:process.cwd()})},succeededProcess=(e,t)=>{(0,cli_utils_1.wl)(`\nset up [42m succeeded [49m: [33m${e}[39m${t??""}`);const i=(0,cli_utils_1.getArg)();null!=i&&process.cwd()!==dir&&((0,cli_utils_1.wl)("\nstart with change directory"),(0,cli_utils_1.wl)(`  cd ${i}`))},writeCreateDescription=e=>{(0,cli_utils_1.wl)(`create [33m${e}[39m: ${descriptions[e]}\n`)},main=async e=>{(0,cli_utils_1.wl)(" ");const t={appName:appName};try{switch(e){case"mod":case"module":writeCreateDescription("mod"),changeDir(),await(0,create_module_1.default)(dir,t),succeededProcess("mod");break;case"cli":case"batch":writeCreateDescription("cli"),changeDir(),await(0,create_cli_1.default)(dir,t),succeededProcess("cli");break;case"fas":case"gui":case"frontend":writeCreateDescription("fas"),changeDir(),await(0,create_next_app_1.default)(dir,"frontend",!1,t),succeededProcess("fas");break;case"bas":case"api":case"backend":writeCreateDescription("bas"),changeDir(),await(0,create_next_app_1.default)(dir,"backend",!1,t),succeededProcess("bas");break;case"web":case"nexpress":case"web-s":writeCreateDescription("web"),changeDir();const i=e.endsWith("-s")||(0,cli_utils_1.hasKeyArg)("-s","--separate");await(0,create_next_app_1.default)(dir,"web",i,t),succeededProcess("web",i?" ( frontend / backend )":"");break;case"dsk":case"desktop":case"nextron":writeCreateDescription("dsk"),changeDir(),await(0,create_next_app_1.default)(dir,"desktop",!1,t),succeededProcess("dsk");break;case"app":case"all":case"full":case"app-s":case"all-s":case"full-s":writeCreateDescription("app"),changeDir(),await(0,create_next_app_1.default)(dir,"all",!1,t),succeededProcess("app");break;case"stt":case"react":writeCreateDescription("stt"),changeDir(),await(0,create_react_app_1.default)(dir,t),succeededProcess("stt");break;case"mob":case"mobile":writeCreateDescription("mob"),changeDir(),await(0,create_react_native_1.default)(dir,t),succeededProcess("mob");break;default:(0,cli_utils_1.wl)("cancel")}}catch(t){process.stderr.write(String(t)),(0,cli_utils_1.wl)(`\nset up [41m failed [49m: ${e}`)}(0,cli_utils_1.wl)(`\n${sepStr}`)};skipInteractive?main(argProjectType):(0,cli_utils_1.rl)("please input (default [33mc[39m) > ").then(main).catch((e=>{process.stderr.write(e),(0,cli_utils_1.wl)(`${pkg.name} [41m failed [49m.`),(0,cli_utils_1.wl)(`\n${sepStr}`)}));